---
title: "Ceph Code Walkthroughs: CoDel for BlueStore"
date: 2021-11-25
updated: 2021-11-26
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议概述
本次会议由专业存储领域分布式存储Ceph的研发人员主持，主要内容是对Ceph的BlueStore中的Cuddle算法进行详细讲解。会议涵盖了问题背景、解决方案架构、代码实现、实验结果等多个方面。

#### 关键细节
1. **问题背景**：
   - 在大多数存储系统中，前端（如OSD）和后端（如BlueStore）分别处理不同层次的存储任务。
   - 当前端队列（如BlueStore中的队列）过大时，会导致前端调度困难，影响系统的可调度性。

2. **解决方案架构**：
   - 引入Cuddle算法，通过智能的准入控制机制，平衡前端可调度性和后端吞吐量。
   - Cuddle算法包括两个循环：高频循环（快速循环）和低频循环（慢速循环）。
   - 快速循环通过目标延迟参数控制请求进入后端的数量，以最小化延迟。
   - 慢速循环则根据系统的吞吐量和延迟优化目标参数，以维持吞吐量和延迟之间的平衡。

3. **代码实现**：
   - 主要代码位于`blueStore_slow_fast_cuddle.cc`和`blueStore_slow_fast_cuddle.h`文件中。
   - 在BlueStore的构造函数中初始化Cuddle算法，并通过配置文件控制算法的激活和参数设置。
   - 快速循环和慢速循环通过定时器触发，分别处理请求的准入控制和参数优化。

4. **实验结果**：
   - 使用FIO生成工作负载，实验在SSD上进行。
   - 实验结果显示，Cuddle算法能够有效控制目标延迟参数，适应不同的工作负载变化。
   - 通过调整目标斜率参数，可以在不显著影响吞吐量的前提下，降低BlueStore中的延迟。

#### 决定事项
- 确认Cuddle算法的有效性，并计划将其集成到Ceph的BlueStore中。
- 计划进一步研究Cuddle算法对前端调度和队列服务质量的影响。

#### 后续行动计划
- 将会议中的详细内容和实验结果整理成文档，添加到相关的Pull Request中。
- 继续优化Cuddle算法，特别是对其在混合IO大小等复杂场景下的性能进行深入研究。
- 定期回顾和讨论Cuddle算法的进展，确保其持续改进和适应新的需求。

#### 其他备注
- 会议中提到的Cuddle算法的设计和实现细节，特别是对目标延迟参数的控制和优化，为后续的研究和开发提供了重要的参考。
- 会议还讨论了Cuddle算法在实际应用中的潜在影响，特别是在提高系统可调度性和服务质量方面的潜力。

---

本次会议为Ceph存储系统的优化提供了新的思路和方法，特别是通过引入Cuddle算法来平衡前端和后端的性能，为未来的存储系统设计提供了宝贵的经验。