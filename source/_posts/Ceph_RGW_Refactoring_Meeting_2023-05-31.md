---
title: "Ceph RGW Refactoring Meeting 2023-05-31"
date: 2023-05-31
updated: 2023-06-01
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议主题：字符串优化及通知重试清理讨论

#### 参会人员：Gabby, Yuval, Eugene, 及其他相关开发人员

#### 主要议题：

1. **字符串优化（Gabby 和 Yuval）**
   - **讨论内容**：
     - 针对S3属性名称（如x-amz-meta-等长字符串）的优化。
     - 属性名称存在多个地方，包括消息、中间结构（如Redis网关）和对象内部。
     - 提议通过哈希将这些长字符串转换为短整数，以减少动态字符串分配和内存使用。
     - 讨论了两种优化级别：在rgw内部进行转换和向客户端发送转换表。
   - **决定事项**：
     - 建议首先在OSD层进行优化，隐藏在内部，不改变现有librados API。
     - rgw可以管理一个本地缓存，从OSD获取转换表，避免全局同步问题。
   - **后续行动**：
     - 继续讨论并确定最佳实施方案。
     - 开发一个测试工具来验证实际使用的属性名称数量。

2. **通知重试和清理（Grinnell）**
   - **讨论内容**：
     - 讨论了通知重试机制，特别是在Kafka broker不可用时的行为。
     - 当前设计是无限重试，直到队列满后向S3客户端发送慢速响应。
     - 提出了几种改进方案，包括设置重试次数上限和清理过期通知。
   - **决定事项**：
     - 发起邮件讨论，收集社区意见，确定最佳方案。
   - **后续行动**：
     - 发送邮件到用户列表，讨论并收集反馈。

3. **其他事项**
   - **Bucket Level Redirect Zone 原型（Eugene）**
     - 讨论了相关PR，但未深入细节。
   - **Reef多站点测试更新（Shilpa）**
     - Mark成功完成了4亿对象的同步负载测试，未发现回归问题。

#### 下一步行动：
- 继续讨论字符串优化方案，并开发测试工具。
- 发送邮件讨论通知重试和清理的最佳方案。
- 跟进Bucket Level Redirect Zone原型的进一步讨论。
- 继续Reef的多站点测试，确保无回归问题。

#### 会议结束：
- 会议超时结束，感谢所有参与者的贡献，期待下次会议。

---

以上是本次会议的详细纪要，涵盖了关键讨论点、决定事项及后续行动计划。