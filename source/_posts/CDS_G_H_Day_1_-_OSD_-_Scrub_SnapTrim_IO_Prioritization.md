---
title: "CDS G/H (Day 1) - OSD: Scrub/SnapTrim IO Prioritization"
date: 2014-06-24
updated: 2014-06-25
tags:
categories:
- "视频总结"
subtitle: tech
---



### 会议纪要

**会议时间**： 下午

**会议主题**： OSD操作优化讨论，重点为scrub、snap trim和IO优先级调整。

**参会人员**： Sam（主持人）、其他研发人员

**会议内容**：

**1. scrub snap trim IO优先级讨论**

* **问题**： 目前存在一些后台IO密集型任务，需要优先级调整以避免影响客户端IO。
* **解决方案**：
    * 将后台任务分配到独立的线程池，并减少其线程数量。
    * 使用内核的IO优先级机制降低这些线程的优先级。
    * 将scrub、snap trim、backfill等任务封装成工作项，并放入OSD操作队列（OSD oport Q）中。
    * 利用OSD oport Q的令牌桶机制平衡恢复请求与客户端请求。
    * 考虑将所有工作项统一放入操作队列中，包括scrub、snap trim、backfill、replica scrub等。
    * 确定每个工作项的成本和优先级，可能需要通过配置选项进行设置。

**2. 操作队列（oper Q）与工作项**

* **操作队列**： 操作队列用于处理各种操作请求，包括scrub、snap trim、backfill等。
* **工作项**： 将scrub、snap trim等任务封装成工作项，并放入操作队列中。
* **优先级**： 操作队列根据优先级和成本处理工作项。对于优先级高于63的工作项，使用严格优先级队列；对于优先级低于63的工作项，根据成本进行动态调整。

**3. PG移除**

* PG移除操作可以保留在现有的线程池中，并设置较低的优先级，以避免其被饿死。

**4. IO优先级**

* IO优先级调整可以与操作队列结合使用，以实现更精细的控制。
* 对于scrub操作，需要在锁的获取和释放之间进行优先级调整。

**5. 后续行动计划**

* 完善scrub、snap trim等任务的优先级和成本设置。
* 考虑将所有工作项统一放入操作队列中。
* 对PG移除操作进行优先级调整。

**会议总结**：

本次会议讨论了OSD操作优化的相关议题，提出了改进方案，并制定了后续行动计划。通过优化操作队列和IO优先级，可以提高系统性能和稳定性。