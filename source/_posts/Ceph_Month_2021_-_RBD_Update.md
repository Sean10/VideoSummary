---
title: "Ceph Month 2021: RBD Update"
date: 2021-06-14
updated: 2021-06-15
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

**会议主题：** RBD 更新报告  
**主讲人：** Ilya（RBD 团队技术负责人）  
**日期：** [会议日期]  

#### 关键细节：
1. **即时导入（Instant Import）**：
   - 在 Nautilus 中引入的图像实时迁移功能已扩展支持外部数据源。
   - 支持通过 HTTP/HTTPS 的本地和远程文件，以及兼容 Amazon S3 的对象存储中的文件。
   - 数据源格式支持 raw、qcow2 等，但不支持高级功能如压缩、加密等。
   - 迁移准备后图像即可使用，读写操作会根据需要从数据源进行深度复制。

2. **内置加密（Built-in Encryption）**：
   - 引入基于 LUKS 的加密，使用 AES 加密算法，支持 LUKS1 和 LUKS2 格式。
   - 解决了 CoW 克隆可能使用相同密钥的问题，但目前仅支持非克隆图像的加密格式化。

3. **性能改进**：
   - 通过重写 librbd I/O 路径，改进了小 I/O 性能，提升了 I/O 操作的效率。
   - 引入了客户端持久写回缓存，改善了缓存管理和数据一致性。

4. **快照 QS 钩子**：
   - 新增 RPC 消息，支持协调快照创建，特别是在集群级别的镜像快照中。

5. **内核客户端支持**：
   - 内核 5.11 支持 Ceph Messenger 2.1 协议，改进了客户端与集群的通信。
   - 支持副本读取和压缩操作，优化了跨数据中心的性能。

6. **Windows 支持**：
   - 实现了 Windows 下的 librbd 和 librados 支持，通过 wnbd 驱动提供类似 Linux 的块设备接口。

#### 决定事项：
- 继续完善和扩展 RBD 的功能，特别是在加密、性能优化和跨平台支持方面。
- 改进用户和管理员体验，特别是在缓存管理和快照操作方面。

#### 后续行动计划：
- 在 Quincy 版本中完成加密格式化克隆和持久写回缓存的改进。
- 扩展崩溃恢复测试，优化缓存状态的可观测性和解释性。
- 增强 RBD 的监控和报警功能，特别是在镜像和快照管理方面。
- 探索和实施 NVMe-oF 目标网关，提升性能和可扩展性。
- 改进 QEMU 块驱动，支持写零操作和加密格式化图像的加载。

**会议结束语：**  
Ilya 感谢大家的参与，并欢迎会后通过 IRC 或电子邮件提出问题。会议记录和演示文稿将提供给未能参加的人员。