---
title: "Using EBPF to Develop a Powerful Tool for Diagnosing Ceph Performance Issues"
date: 2023-05-05
updated: 2023-05-05
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

**会议主题：** 使用 eBPF 开发强大的性能诊断工具

**主讲人：** 来自 Canonical 的软件工程师

**会议内容概述：**

1. **OSD 操作生命周期介绍**
   - OSD 操作生命周期主要分为三个层次：messenger 层、OSD 层和 Blue Store 层。
   - 每个层次的操作包括接收、处理和提交数据，涉及网络性能、队列管理和磁盘操作。

2. **现有性能分析方法及其局限性**
   - 介绍了 perf 工具、调试日志、管理命令和静态追踪（如 lttng 和 blocking）等方法。
   - 指出了这些方法在详细延迟分析、日志处理和跨层次追踪方面的局限性。

3. **eBPF 和 u-plop 技术的介绍**
   - eBPF 是一种内核技术，允许在不修改内核代码或加载额外模块的情况下，将自定义程序添加到内核中。
   - u-plop 是一种允许动态追踪用户空间代码的机制，通过注入追踪点来实现。

4. **工具演示**
   - 演示了如何使用 eBPF 和 u-plop 技术开发的工具来追踪和分析 OSD 操作的详细延迟。
   - 展示了工具在实际集群中的应用，包括网络性能问题和磁盘操作延迟的诊断。

5. **未来工作**
   - 讨论了工具的潜在改进，如检测 OSD 后台任务和扩展到更多 Ceph 组件的追踪。

**决定事项：**
- 主讲人计划将开发的工具开源，以便社区使用和进一步开发。

**后续行动计划：**
- 主讲人将整理代码并尽快发布到开源社区。
- 继续优化工具，特别是减少性能开销和扩展功能，以支持更广泛的应用场景。

**会议结束：**
- 会议以问答环节结束，主讲人回答了关于工具性能、开源计划和潜在应用的问题。

**备注：**
- 主讲人强调了 eBPF 和 u-plop 技术在动态追踪和性能分析中的强大能力，但也指出了在实际部署中需要考虑的性能开销问题。

**会议反馈：**
- 与会者对工具的潜力表示了兴趣，并提出了关于工具在大规模集群中应用的性能问题。

**会议总结：**
- 本次会议详细介绍了如何利用 eBPF 和 u-plop 技术开发高性能诊断工具，以帮助 Ceph 存储系统的性能优化和问题诊断。