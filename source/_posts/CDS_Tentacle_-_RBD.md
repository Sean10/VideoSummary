---
title: "CDS Tentacle - RBD"
date: 2024-08-23
updated: 2024-08-23
tags:
categories:
- "视频总结"
subtitle: tech
---



### 会议纪要

**会议主题**： RBD (RADOS Block Device) 开发者峰会会议纪要

**会议时间**： 2023年11月（具体日期未提及）

**参会人员**： RBD 团队成员，Zia（负责一致性组快照镜像），Roma（负责快照调度器），niia 和 RAM（负责相关子任务）

**会议内容**：

**一、一致性组快照镜像**

*   **主要议题**： 实现基于快照的一致性组镜像功能。
*   **关键细节**：
    *   Zia 正在工作的主要 PR 目前处于工作进度中，代码功能基本就绪，但尚需对处理一致性组强制提升、参数描述、同步元数据对象等细节进行完善。
    *   Ramana 正在开发一致性组快照调度器，Nya 协助进行代码审查和快照列表功能开发。
    *   重点关注强制提升的测试覆盖范围，目前测试用例过于简单，需要增加更复杂的测试用例，并考虑多快照测试。
    *   快照调度器将支持组级别快照调度，并应用于组内所有镜像，但不会支持不同镜像的不同调度策略。
    *   将 PR 切分成多个部分，以降低风险并确保现有功能的稳定性。

**二、RBD 镜像相关缺陷**

*   **主要议题**： 解决 RBD 镜像功能中存在的缺陷。
*   **关键细节**：
    *   解决克隆镜像中快照镜像功能的问题，确保克隆镜像可以正常进行快照镜像。
    *   解决内置 LUKS 加密中数据损坏的问题，确保在快照镜像过程中数据一致性。
    *   解决丢弃操作无法正确传播到二级集群的问题，确保二级镜像占用空间正确。
    *   解决强制提升和源集群不可用问题，提高镜像功能的健壮性。

**三、内置 LUKS 加密和实时迁移改进**

*   **主要议题**： 改进内置 LUKS 加密功能和实时迁移功能。
*   **关键细节**：
    *   解决从加密源读取数据时数据损坏的问题。
    *   保留读取操作时的空间信息，确保加密镜像的碎片信息正确。
    *   支持从其他子集群导入镜像，提高实时迁移的灵活性。
    *   支持 NBD 格式实时迁移流，扩展实时迁移的适用场景。
    *   解决从克隆镜像迁移时加密操作重复执行的问题。

**四、其他改进**

*   **主要议题**： 改进缺陷 API 和 libRADOS 库，使其支持非用户快照。
*   **关键细节**： 确保非用户快照（如一致性组快照、镜像快照、垃圾箱快照）在 RBD 命令行工具中可访问，并修复仪表板中的相关问题。

**五、后续行动计划**

*   RBD 团队将继续推进 RBD 镜像功能、内置 LUKS 加密功能和实时迁移功能的改进，并修复相关缺陷。
*   将 PR 切分成多个部分，并逐步合并到 RBD 中。
*   与社区合作，解决其他改进项。

**六、会议总结**

本次会议讨论了 RBD 镜像功能和实时迁移功能的改进计划，并明确了后续行动计划。RBD 团队将继续努力，提高 RBD 的功能和稳定性，为用户提供更好的存储解决方案。