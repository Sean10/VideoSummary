---
title: "CDS G/H (Day 1) - OSD: Scrub & Repair"
date: 2014-06-24
updated: 2014-06-25
tags:
categories:
- "视频总结"
subtitle: tech
---



### 会议纪要

**会议时间**： 2023年11月 (具体日期未提及)

**会议地点**： 线上会议

**参会人员**： (未提及具体姓名，以下用“与会者”代替)

**会议主题**： Ceph 分布式存储系统中的 OSD Scrub 和 Repair 功能讨论

**会议内容**：

**一、主要议题**

1. **Scrub 和 Repair 问题**：
    * 当前 Scrub 功能存在不一致性时，需要手动分析中央日志，难以识别具体问题。
    * 建议增加接口，让 OSD 在 Scrub PG 时跟踪不一致性，并记录到 LevelDB 中。
    * 不一致性信息与活跃区间逻辑绑定，便于后续处理。

2. **接口设计**：
    * 需要定义所有对象不一致的方式，作为基础数据结构。
    * OSD 遇到不一致对象时，使用该数据结构描述并记录到 LevelDB。
    * 增加一个查询不一致 PG 的接口，以及查询特定对象不一致信息的接口。
    * 增加修复不一致对象的接口，并考虑异步执行。

3. **实现细节**：
    * 使用 SnapMapper 等架构设备记录不一致信息。
    * 使用新的 Radius API，需要提供 Epic 序列号，以便比较请求。
    * 增加读取特定副本的接口，以及修复副本的接口。
    * 考虑将修复操作与 Radius 操作分离。

4. **一致性信息结构**：
    * 不一致性信息应包含与对象和一致性设计相关的所有信息。
    * 需要避免在结构中遗漏信息，否则无法传播给 Liberators。

5. **Replica 修复**：
    * 对于副本，可以使用列表指定用于修复的正确副本。
    * 可以考虑将修复操作与 Radius 操作分离。

6. **自动修复**：
    * 可以在 Scrub 命令中使用接口实现自动修复，或设置自动修复策略。

7. **内部 OSD 元数据不一致**：
    * 内部 OSD 元数据不一致可以通过修改对象信息来解决。
    * 可以考虑将修复操作与 Radius 操作分离。

**二、决定事项**

1. 增加接口，让 OSD 在 Scrub PG 时跟踪不一致性，并记录到 LevelDB 中。
2. 定义不一致信息的数据结构，并记录到 LevelDB 中。
3. 增加查询不一致 PG 和对象的接口。
4. 增加修复不一致对象的接口，并考虑异步执行。
5. 考虑将修复操作与 Radius 操作分离。
6. 实现自动修复功能。
7. 考虑将内部 OSD 元数据不一致的修复操作与 Radius 操作分离。

**三、后续行动计划**

1. 与会者将根据会议讨论结果进行代码实现。
2. 定期进行代码审查和讨论。
3. 完成功能开发后，进行测试和验证。

**四、其他事项**

1. 会议中讨论了使用 Radius API 或 PGTell 接口的问题，最终决定使用 Radius API。
2. 会议决定将修复操作与 Radius 操作分离，以避免引入过多的复杂性。