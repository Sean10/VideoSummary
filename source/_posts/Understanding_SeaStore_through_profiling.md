---
title: "Understanding SeaStore through profiling"
date: 2022-11-14
updated: 2022-11-15
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议主题：理解系统性能分析（System Profiling）

#### 主讲人：Inching

#### 背景介绍：
Inching 在 Crimson 项目工作多年，主要熟悉 Crimson Messenger 及其姊妹项目。Crimson 项目旨在有效利用多核 CPU 驱动现代硬件的快速 I/O，采用共享内存设计以减少跨核心的互斥和共享资源，设计为租约完成以最小化跨核心跳转和接触开销，目标是使性能随核心数量可扩展。实现基于 C-star 框架，该框架桥接操作系统和硬件与 Crimson 软件，以实现设计目标。所有 Crimson 代码都在系统框架上实现。

#### 主要议题：
1. **Crimson 和 Sister 项目的目标**：有效利用多核 CPU 驱动快速 I/O，使用共享内存设计减少跨核心资源共享，设计为租约完成以最小化跨核心跳转和接触开销。
2. **C-star 框架**：桥接操作系统和硬件与 Crimson 软件，实现设计目标。
3. **C-store 目标**：支持多种设备（如 SSD、NVMe），具有不同的性能特征。
4. **性能分析步骤**：
   - 生成工作负载：来自实验室 RPD 客户端或存储 MBD 直接生成。
   - 收集指标：从 C-star 框架收集，需要在软件层实现。
   - 数据可视化：理解收集数据的关系和性能趋势。

#### 决定事项：
- 性能分析的重要性：诊断多重问题、预测性能趋势、识别不同实现的潜力、识别性能回归、验证不同特性和修复。
- 性能分析分为四个部分：存储背景、五个不同的性能分析部分、实际优化示例、关键要点。

#### 后续行动计划：
- 继续开发和完善性能分析工具和方法。
- 根据性能分析结果进行优化和改进。
- 保持代码和工具的更新，以适应不断变化的需求。

#### 关键要点：
- 性能分析是优化的大部分工作，已引入超过1000个指标和28个PR用于性能分析和工具开发，15个PR用于实际优化。
- 优化需要以性能分析为导向，确保方向正确，避免不必要的复杂性。
- 性能分析迭代需要在所有步骤中进行，包括识别问题、测试场景、重现问题、根本原因分析、提出解决方案和验证解决方案的有效性。
- 性能分析需要在引入的开销和代码复杂性之间取得平衡，以获得必要的分析步骤。

#### 参考资料：
- C-star 框架介绍
- 收集指标数据的脚本
- 系统代码和日志结构化设计论文链接

#### 问答环节：
- **问题**：Crimson OST 和 C-store 能否根据实际工作负载性能特征自动优化，例如自动内存分配？
  - **回答**：目前尚未考虑，当前优化主要针对严重问题。如果原始实现稳定后，这可能是一个好的方向。
- **问题**：是否可以基于设置的标签追踪客户端 I/O，例如可开发设备引起的问题？
  - **回答**：可能，但需要找到连接操作和问题的方法，因为它们通常在不同层次。

#### 结论：
Inching 详细介绍了 Crimson 项目的性能分析和优化过程，强调了性能分析在系统优化中的重要性，并提出了未来的优化方向和可能的改进措施。