---
title: "Ceph Performance Meeting 2021-03-25"
date: 2021-03-26
updated: 2021-03-27
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 关键细节
- **PR更新**: 过去两周有两个新的PR更新。
  - 一个涉及将`o_node_map`从`unordered_map`改为`std::map`，这是一个有争议的改动，目前作为RFC（征求意见）进行。
  - 另一个是关于RGW的PR，涉及在RGW压缩后不进行OSD压缩的问题。

- **已关闭的PR**: 过去两周有三个PR被关闭。
  - 其中一个涉及将alien store线程分散到指定的CPU核心。
  - 另一个涉及将bluefs的buffered I/O设置为true，这是一个必要的改动，因为之前禁用buffered I/O导致了一些性能问题。

- **性能优化**:
  - 动态pen length PR已经合并，解决了对齐问题，并显示出性能提升。
  - Gabby的PR移除了roxdb中的分配，性能改进看起来很好。

- **OMAP性能问题**:
  - 讨论了bluefs的buffered I/O和omap性能问题，特别是关于hash collisions和数据结构的优化。
  - 提出了使用`std::map`或定制的`unordered_map`来解决hash collisions问题。

- **缓存管理**:
  - 讨论了缓存管理的问题，特别是关于缓存分裂和锁定机制的复杂性。
  - 提出了简化缓存管理的建议，例如永久性地将节点附加到缓存shard。

#### 主要议题
- **数据结构优化**: 讨论了如何优化数据结构以减少hash collisions，特别是`o_node_map`的使用。
- **性能问题**: 讨论了buffered I/O和omap性能问题，以及如何通过改进缓存管理和数据结构来解决这些问题。
- **缓存管理**: 讨论了缓存分裂和锁定机制的复杂性，提出了简化缓存管理的建议。

#### 决定事项
- **PR合并**: 动态pen length PR已经合并，解决了对齐问题，并显示出性能提升。
- **数据结构优化**: 决定继续讨论和优化`o_node_map`的数据结构，可能采用`std::map`或定制的`unordered_map`。
- **缓存管理**: 决定继续讨论和简化缓存管理的方案，特别是关于缓存分裂和锁定机制的改进。

#### 后续行动计划
- **数据结构优化**: 继续讨论和实施`o_node_map`的数据结构优化方案。
- **性能问题**: 继续调查和解决buffered I/O和omap性能问题。
- **缓存管理**: 继续讨论和实施简化缓存管理的方案，特别是关于缓存分裂和锁定机制的改进。
- **PR审查**: 继续审查和合并相关的PR，确保代码质量和性能优化。

#### 备注
- 会议超时，但未有其他重要事项提出。