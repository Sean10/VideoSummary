---
title: "Ceph Tech Talk 2020-06-25: Solving the Bug of the Year"
date: 2020-06-25
updated: 2020-06-26
tags:
categories:
- "视频总结"
subtitle: tech
---


---
title: "Ceph Tech Talk 2020-06-25: Solving the Bug of the Year"
date: 2020-06-25
updated: 2020-06-26
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

**会议主题：** 解决年度Bug的技术分享

**主讲人：** Dan（来自CERN IT部门）

**会议时间：** [具体日期未提供]

**会议地点：** 线上

**参会人员：** Ceph社区成员及相关技术人员

**会议内容总结：**

1. **背景介绍：**
   - CERN（欧洲核子研究组织）位于日内瓦，拥有世界上最大的机器——大型强子对撞机（LHC），并因发现希格斯玻色子而闻名。
   - Ceph自2013年起成为CERN IT基础设施的关键部分，特别是用于OpenStack的块存储和对象存储。
   - CERN拥有约10个Ceph集群，总存储容量达35 PB。

2. **问题描述：**
   - 2020年2月20日，CERN的OpenStack块存储系统突然宕机，25%的OSD（对象存储守护进程）失效，导致所有I/O操作被阻塞。
   - 经过初步调查，发现OSD进程无法重启，日志文件显示OSD映射（OSD map）存在CRC错误。

3. **诊断与解决过程：**
   - 通过与Ceph社区的交流，快速定位到一个已知的相关问题，并找到了一个临时解决方案。
   - 从Mon节点提取未损坏的OSD映射版本，覆盖损坏的版本，恢复了集群的运行。
   - 进一步分析发现，损坏的OSD映射存在多个比特位翻转，怀疑是内存ECC错误、网络包损坏或软件bug。

4. **根本原因分析：**
   - 排除了内存ECC错误和网络包损坏的可能性。
   - 发现问题与LZ4压缩算法有关，特别是当压缩未对齐的内存时，可能导致数据损坏。
   - 通过与LZ4开发者合作，确认了问题并找到了修复方案。

5. **后续行动计划：**
   - 计划引入块存储可用性区域，以提高系统的容错能力。
   - 将持续关注Ceph社区的更新，并考虑升级操作系统中的LZ4库版本。

**感谢与致谢：**
- 感谢Ceph社区成员，特别是Dirtwash、Troy和Eric的帮助。
- 感谢CERN IT团队的同事们，以及LZ4算法的开发者。

**会议结束：**
- 会议内容将被录制并上传至YouTube。

**备注：**
- 本次会议详细讨论了Ceph集群中遇到的一个罕见但严重的Bug，以及如何通过社区合作和技术分析找到并解决问题的过程。