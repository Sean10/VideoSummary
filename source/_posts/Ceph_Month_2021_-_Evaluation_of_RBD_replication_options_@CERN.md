---
title: "Ceph Month 2021: Evaluation of RBD replication options @CERN"
date: 2021-06-22
updated: 2021-06-22
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议主题：CERN SAFE项目中RBD复制选项的评估

#### 主讲人：Archer

#### 会议内容总结：

1. **项目背景与目标**：
   - Archer自三月起作为研究员加入CERN的SAFE团队。
   - SAFE项目涉及四个Ceph集群，为OpenStack Cinder提供服务，管理约七千个卷，总容量达八兆字节。
   - 项目目标是为Cinder卷提供灾难恢复解决方案，允许用户在不同集群（数据中心或数据中心内的不同房间）之间进行复制。

2. **技术细节与挑战**：
   - **RBD复制模式**：
     - **日志模式（Journal Mode）**：
       - 客户端在写入RBD镜像的同时写入日志，导致性能问题，尤其是在大块写入时，性能下降约50%。
       - 镜像性能在默认设置下较慢，每镜像约30MB/s，通过调整参数可提升至40-50MB/s，但仍不理想。
     - **快照模式（Snapshot Mode）**：
       - 通过定期快照实现数据复制，非连续复制，性能优于日志模式，每镜像可达200MB/s。
       - 目前OpenStack Cinder不支持快照镜像，但已提交补丁，预计未来版本可能支持。

3. **测试环境**：
   - 使用SAFE Octopus版本，配置包括6台实验机，60个OSDs（混合场景，数据在HDD，DB在SSD），18个OSDs专用于RBD日志。
   - 客户端运行FIO进行随机写负载测试。

4. **结论与后续行动**：
   - 鉴于日志模式的性能问题，团队计划采用快照模式进行进一步测试和优化。
   - 已提交五个补丁以提高RBD复制的可观察性和稳定性，并计划继续与社区合作，贡献代码。

5. **问答环节**：
   - **快照频率**：初始测试中使用最小频率（1分钟），但实际应用中可能会根据FS3S快照工作的进展调整。
   - **文件系统冻结支持**：目前尚未遇到因缺乏文件系统冻结支持导致的问题，但预计未来应用中会有所帮助。
   - **日志模式性能**：在较大RBD集群中，客户端性能可能受限于集群带宽，尤其是进行双写操作时。

#### 后续行动计划：
- 继续测试快照模式，确保其稳定性和性能。
- 与OpenStack Cinder开发团队合作，推动快照镜像功能的集成。
- 持续提交补丁，优化RBD复制的性能和稳定性。

#### 会议结束语：
感谢Archer的详细介绍和解答，期待后续的进展和成果。