---
title: "Attempting to Improve Discard Performance | Ceph Days NYC 2024"
date: 2024-06-18
updated: 2024-06-19
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议概述
本次会议主要讨论了分布式存储系统Ceph中遇到的一个性能问题，特别是与RBD（RADOS Block Device）工作负载相关的问题。会议详细探讨了问题的发现、分析过程、解决方案以及未来的改进方向。

#### 关键细节
1. **问题发现**：
   - 在特定的驱动模型中，当驱动器被大量写入并开始覆盖旧数据时，性能突然下降。
   - 该问题在驱动器满载且未发送丢弃命令（discards）时尤为明显。

2. **初步解决方案**：
   - 在部分驱动模型上启用异步丢弃命令，发现对某些模型的性能有显著提升，但对其他模型影响不大。
   - 与驱动器供应商合作，获取新的固件更新以解决性能问题。

3. **固件更新效果**：
   - 新固件使丢弃命令的执行速度提升近一倍，但仍远低于参考模型。

4. **内部改进尝试**：
   - 尝试通过增加丢弃线程池来提高丢弃命令的并行处理能力，但效果不明显。
   - 发现驱动器固件可能以单线程方式处理丢弃命令，限制了并行处理的潜力。

5. **其他潜在改进**：
   - 研究不同的分配器（allocator）对性能的影响，特别是针对混合分配器和AVL分配器的比较。
   - 需要进一步测试以确定不同分配器对不同类型驱动器的影响。

#### 决定事项
- 继续与供应商合作，优化固件以进一步提升性能。
- 进一步研究并测试不同的分配器，以找到最适合当前存储环境的配置。
- 继续在社区中分享和讨论改进方案，以获取更多反馈和建议。

#### 后续行动计划
- 继续监控和分析启用丢弃命令后的性能数据。
- 与社区合作，推动并优化丢弃命令的多线程支持。
- 定期回顾和评估分配器的性能，确保最佳配置。

#### 总结与反思
- 本次问题的解决过程中，团队通过深入挖掘和与社区的紧密合作，成功找到了初步解决方案。
- 使用开源产品Ceph的优势在于能够快速响应问题，并与社区共同进步。
- 对社区的贡献不仅帮助了自身，也促进了整个社区的发展和成熟。

#### 致谢
- 对Ceph社区的支持和帮助表示感谢，并鼓励团队成员继续积极参与社区贡献。

本次会议记录涵盖了问题的发现、分析、解决方案及未来展望，为后续的工作提供了明确的方向和行动计划。