---
title: "Optimizing CephFS with Combining MDS QoS Scheduling and Static-Dynamic Subtree Partitioning"
date: 2023-05-05
updated: 2023-05-05
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议概述
本次会议由Young主持，来自Lion公司的专业人员分享了他们在Ceph分布式存储系统上的工作进展和经验。会议主要讨论了Ceph文件系统（CFS）的调度、软件分区以及动态和静态子树分区策略。

#### 主要议题
1. **公司背景与Ceph应用介绍**
   - Lion公司是一家提供消息和通信服务的公司，拥有超过1.5亿日活跃用户。
   - 公司采用OpenStack和Kubernetes作为私有云基础设施，并使用Azure软件定义存储策略。
   - 具体使用了RBD和rgw来提供块和对象存储接口，自2020年起成功采用CFS。

2. **Ceph文件系统（CFS）的应用与挑战**
   - 介绍了CFS与OpenStack Manila的集成，用于处理OpenStack项目的共享卷。
   - 面临的主要挑战包括AI和ML工程师存储大量数据（高达50亿条），以及如何有效管理这些数据。

3. **集群管理与性能优化**
   - 描述了两个主要集群（A和B）的配置，每个集群有超过30个活动实例。
   - 讨论了从裸金属服务器到虚拟机的转变，以及如何通过小规模虚拟机来优化MDS。

4. **动态与静态子树分区策略**
   - 动态子树分区：能够动态调整元数据分布，但可能导致迁移开销和性能波动。
   - 静态子树分区：通过预分配特定链接来减少元数据迁移，但可能导致工作负载分布不均。

5. **结合动态与静态分区的新策略**
   - 提出了一种结合两种分区策略的新方法，旨在处理不同类型的工作负载，优化性能和减少迁移开销。

6. **MDS QoS调度器**
   - 介绍了基于M Clock算法的QoS调度器，用于控制MDS的请求处理速度，确保稳定性和性能。

#### 决定事项
- 确定了结合动态与静态分区策略的新架构，以优化CFS的性能和稳定性。
- 实施了MDS QoS调度器，以更好地管理MDS的请求处理和资源分配。

#### 后续行动计划
- 继续测试和优化新的分区策略，确保其在多种工作负载下的有效性。
- 进一步开发和部署MDS QoS调度器，以应对复杂的应用场景和增加的需求。
- 持续与社区合作，分享经验并获取反馈，以不断改进Ceph的性能和功能。

#### 结论
Lion公司通过结合动态与静态分区策略以及实施MDS QoS调度器，有效地优化了Ceph文件系统的性能和稳定性。未来将继续探索更多优化措施，并积极参与社区贡献。

#### 提问环节
- 讨论了在多MDS环境下动态分区时的锁争用问题，以及如何通过外部子树分区器来减少元数据迁移。
- 探讨了MDS缓存大小的优化和MDS数量的最佳配置。

会议结束时，主持人感谢所有参与者的积极参与，并欢迎大家提供进一步的反馈和建议。