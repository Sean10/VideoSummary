---
title: "2019-05-24 :: Ceph Code Walkthrough: RGW Multisite Replication"
date: 2020-06-22
updated: 2020-06-23
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议主题：Ceph多站点代码走查

#### 主讲人：[主讲人姓名]

#### 会议时间：[会议日期]

#### 会议内容总结：

1. **高层次概述**：
   - 主讲人介绍了基于日志的复制工作原理，包括不同类型的多站点日志、读取模型和协同程序（co-routines）的工作方式。
   - 讨论了元数据和数据同步的代码细节。

2. **日志基础复制**：
   - 在两个不同集群（位于世界不同地区）之间，每个集群上放置一个Zone，并将它们链接在一起。
   - 当一个Zone（Zone A）进行更改时，它会在本地将更改写入日志，另一个Zone（Zone B）会从Zone A读取日志并获取最新副本。

3. **主要日志类型**：
   - **元数据日志**：记录用户和桶的所有更改。
   - **桶索引日志**：存储在桶索引中，记录对象的所有更改。
   - **数据更改日志**：记录哪些桶及其分片有更改。

4. **日志分片**：
   - 这些多站点日志被分片存储在多个Rados对象中，以分散读取和写入操作，以及在同一Zone内运行的不同网关之间分散复制工作。

5. **线程模型**：
   - 每个源Zone都有一个元数据同步线程和一个数据同步线程。
   - 元数据同步有一个主Zone，其他Zone只从主Zone同步。
   - 数据同步是主动-主动模式，每个Zone都从其他Zone同步数据。

6. **协同程序框架**：
   - 协同程序（co-routines）用于处理多个分片并行工作，避免线程阻塞。
   - 协同程序框架包括协同程序类、堆栈和调度管理器。

7. **元数据同步**：
   - 元数据同步从主Zone读取元数据日志，并将其存储在本地。
   - 元数据同步包括全量同步和增量同步。

8. **数据同步**：
   - 数据同步处理数据更改日志，并启动桶同步进程。
   - 数据同步也包括全量同步和增量同步。

9. **桶同步**：
   - 桶同步从其他Zone读取桶索引日志，并处理日志条目。
   - 桶同步包括全量同步和增量同步。

10. **问题与讨论**：
    - 讨论了协同程序的调用方式、日志分片的管理、错误处理和重试机制。
    - 解答了关于多部分对象处理、元数据同步的删除识别、Zone和Zone Group的配置等问题。

#### 决定事项：
- 需要对代码中的魔法数字（magic numbers）进行审查和优化。
- 确认了协同程序框架的设计和使用方式。

#### 后续行动计划：
- 继续优化和审查代码中的魔法数字。
- 深入理解协同程序框架的实现和应用。
- 确保多站点复制的稳定性和性能。

#### 会议结束：
- 会议在预定时间内圆满结束，感谢所有参与者的积极参与和提问。

---

**注：** 以上纪要涵盖了会议的关键细节、讨论的主要议题、决定的事项以及后续的行动计划。涉及的计算机科学/Ceph相关领域英文原文关键词已保留。