---
title: "CDS Pacific: RBD"
date: 2020-04-02
updated: 2020-04-03
tags:
categories:
- "视频总结"
subtitle: tech
---


### 会议纪要

#### 会议主题：Ceph Pacific 版本的 RBD 部分讨论

#### 会议时间：2020年4月2日 14:00 UTC

#### 参会人员：Ceph 研发团队成员及相关领域专家

#### 主要议题及讨论内容：

1. **RBD 功能特性更新**
   - **Care Buddy 特性**：虽然不直接与 Pacific 版本绑定，但希望在此开发周期内完成。Elia 正在处理与 RBD 相关的 messenger 工作，但目前进展顺利。
   - **压缩提示**：在 Octopus 周期后期添加，允许在 RBD 池中的图像上设置压缩提示，以优化压缩行为。
   - **本地化读取提示**：允许在图像上设置提示，以基于 CRUSH 位置进行本地化读取，特别适用于跨数据中心的集群。

2. **异步重构**
   - 主要涉及 exclusive lock 代码的异步重构，这是当前同步路径中的最后一个障碍。此重构对于未来开发和功能实现至关重要。

3. **性能优化**
   - 讨论了 librbd 的缓存机制，特别是对象 ID 的哈希映射缓存，以减少 CPU 使用和提高小工作负载的性能。
   - 探讨了 librbd 的新 IO 接口，旨在通过线程池和更快的 IO 处理来提高性能。

4. **RBD 与 RGW 集成**
   - 计划通过 RGW 暴露 RBD 快照，利用新的 zipper 插件层，实现快照差异的程序化暴露，而无需复制数据。

5. **即时恢复功能**
   - 讨论了从 S3 或 Swift 备份的 RBD 图像进行即时恢复的功能，类似于实时迁移，但使用 S3 或 Swift 客户端来满足读取需求。

6. **客户端加密**
   - 讨论了在 librbd 中实现客户端侧加密的可能性，以解决克隆图像和快照的加密问题，特别是初始化向量（IV）的管理。

7. **RBD NBD 守护进程**
   - 计划实现一个 RBD NBD 守护进程，能够服务多个块设备，以适应 Kubernetes 和容器环境的需求。

8. **快照协调**
   - 讨论了在创建快照时协调客户端工作负载的可能性，包括冻结和解冻文件系统，以避免数据不一致。

#### 决定事项：
- 继续推进异步重构工作，以支持未来的功能开发。
- 探索和实现 RBD 与 RGW 的集成，以及即时恢复功能。
- 研究客户端侧加密的实现，特别是 IV 管理的问题。

#### 后续行动计划：
- 完成异步重构，并确保其稳定性和性能。
- 实现 RBD NBD 守护进程的多设备支持。
- 继续研究和开发客户端侧加密功能。
- 监控和优化 librbd 的性能，特别是在高吞吐量和高工作负载情况下的表现。

#### 会议总结：
会议涵盖了多个关键的 RBD 功能更新和性能优化议题，团队将继续推进这些工作，以确保 Pacific 版本的顺利发布和高质量。